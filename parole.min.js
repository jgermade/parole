!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):e.Parole=n()}(this,function(){var e,n,t,o="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"Promise"in(e="object"==typeof window?window:this)&&"function"==typeof e.Promise.resolve?(n=e.Promise.resolve(),function(e){n.then(e)}):"MutationObserver"in e?(t=document.createTextNode(""),function(e){var n=new MutationObserver(function(){e(),n.disconnect()});n.observe(t,{characterData:!0}),t.data=!1}):e.setImmediate||e.setTimeout;function u(e){return"object"==typeof e||"function"==typeof e}function i(e){return u(e)&&"then"in e}function r(e,n,t,o,i){var c,f;if(n&&u(n))try{if(n===e)throw new TypeError("A promise can not be resolved by itself");c=n.then,t&&"function"==typeof c?function(e,n,t,o,u,i){try{e.call(o,function(e){n(t,e,!0,u,i)},function(e){n(t,e,!1,u,i)})}catch(e){n(t,e,!1,u,i)}}(c,(f=r,function(){f&&f.apply(this,arguments),f=null}),e,n,o,i):(t?o:i)(n)}catch(e){i(e)}else(t?o:i)(n)}function c(e){for(var n=0,t=e.length;n<t;n++)e[n]()}function f(e){if(!(this instanceof f))return new f(e);var n=this,t=function(e){n.fulfilled||n.rejected||(n.rejected=!0,n.value=e,o(function(){c(n.queue)}))};n.queue=[],e(function(e){r(n,e,!0,function(e){n.fulfilled||n.rejected||(n.fulfilled=!0,n.value=e,o(function(){c(n.queue)}))},t)},t)}return f.prototype.then=function(e,n){var t=this;return new f(function(u,i){function r(){var o=t.fulfilled?e:n;if("function"==typeof o)try{u(o(t.value))}catch(e){i(e)}else t.fulfilled?u(t.value):i(t.value)}t.fulfilled||t.rejected?o(r):t.queue.push(r)})},f.prototype.catch=function(e){return this.then(null,e)},f.defer=function(){var e={};return e.promise=new f(function(n,t){e.resolve=n,e.reject=t}),e},f.when=function(e){return e&&e.then?e:f.resolve(e)},f.resolve=function(e){return new f(function(n){n(e)})},f.reject=function(e){return new f(function(n,t){t(e)})},f.all=function(e){var n=e.length;return new f(function(t,o){var u=new Array(n);e.forEach(function(e,r){var c=function(e){u[r]=e,--n||t(u)};i(e)?e.then.call(e,c,o):c(e)})})},f.race=function(e){return new f(function(n,t){e.forEach(function(e){i(e)?e.then.call(e,n,t):n(e)})})},f});