!function(e,n){function t(){var e={exports:{}};return n(e),e.exports}"function"==typeof define&&define.amd?define([],t):"object"==typeof exports&&"undefined"!=typeof module?n(module):e.Parole=t()}(this,function(e){function n(e,n,t,o){if("function"==typeof e)try{n.resolve(e(t))}catch(e){n.reject(e)}else n[o?"resolve":"reject"](t)}function t(e,t,o){if(!e.resolved){e.resolved=!0,e.result=t,e.fulfilled=o||!1;var r=e.queue.splice(0);e.queue=null,setTimeout(function(){for(var e=0,i=r.length;e<i;e++)n(r[e][o?0:1],r[e][2],t,o)},0)}}function o(e,n,t){var o=!1;try{e.call(t,function(e){o||(o=!0,r(n,e,!0))},function(e){o||(o=!0,r(n,e,!1))})}catch(e){if(o)return;r(n,e,!1)}}function r(e,n,r){var i;if(!n||"object"!=typeof n&&"function"!=typeof n)t(e,n,r);else try{i=n.then,r&&"function"==typeof i?o(i,e,n):t(e,n,r)}catch(n){t(e,n,!1)}}function i(e,n,t){e.resolving||(e.resolving=!0,n===e.promise&&(t=!1,n=new TypeError("A promise can not be resolved by itself")),r(e,n,t))}function u(e){if(!(this instanceof u))return new u(e);if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");var n={queue:[],promise:this};this.__promise=n;try{e(function(e){i(n,e,!0)},function(e){i(n,e,!1)})}catch(e){i(n,e,!1)}}function f(e,n){for(var t=0,o=e.length;t<o;t++)n(e[t],t)}u.prototype.then=function(e,t){var o=this.__promise,r=u.defer();return o.queue?o.queue.push([e,t,r]):setTimeout(function(){n(o.fulfilled?e:t,r,o.result,o.fulfilled)},0),r.promise},u.prototype.catch=function(e){return this.then(null,e)},u.defer=function(){var e={};return e.promise=new u(function(n,t){e.resolve=n,e.reject=t}),e},u.when=function(e){return e&&e.then?e:u.resolve(e)},u.resolve=function(e){return new u(function(n){n(e)})},u.reject=function(e){return new u(function(n,t){t(e)})},u.all=function(e){return new u(function(n,t){var o=e.length,r=[];f(e,function(e,i){(e.then?e:u.resolve(e)).then(function(e){r[i]=e,0===--o&&n(r)},function(e){o!==-1&&t(e)})})})},u.race=function(e){return new u(function(n,t){var o=!1;f(e,function(e){o||(e.then?e:u.resolve(e)).then(function(e){o||(o=!0,n(e))},function(e){o||(o=!0,t(e))})})})},e.exports=u});