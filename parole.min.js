!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):e.Parole=n()}(this,function(){var e,n,t="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"MutationObserver"in(e="object"==typeof window?window:this)?(n=document.createTextNode(""),function(e){var t=new MutationObserver(function(){e(),t.disconnect()});t.observe(n,{characterData:!0}),n.data=!1}):e.setImmediate||e.setTimeout;function o(e){return"object"==typeof e||"function"==typeof e}function u(e){return o(e)&&"then"in e}function c(e,n,t,u,f){var i,r;if(n&&o(n))try{if(n===e)throw new TypeError("A promise can not be resolved by itself");i=n.then,t&&"function"==typeof i?function(e,n,t,o,u,c){try{e.call(o,function(e){n(t,e,!0,u,c)},function(e){n(t,e,!1,u,c)})}catch(e){n(t,e,!1,u,c)}}(i,(r=c,function(){r&&r.apply(this,arguments),r=null}),e,n,u,f):(t?u:f)(n)}catch(e){f(e)}else(t?u:f)(n)}function f(e){for(var n=0,t=e.length;n<t;n++)e[n]()}function i(e){if(!(this instanceof i))return new i(e);var n=this,o=function(e){n.fulfilled||n.rejected||(n.rejected=!0,n.value=e,t(function(){f(n.queue)}))};n.queue=[],e(function(e){c(n,e,!0,function(e){n.fulfilled||n.rejected||(n.fulfilled=!0,n.value=e,t(function(){f(n.queue)}))},o)},o)}return i.prototype.then=function(e,n){var o=this;return new i(function(u,c){function f(){var t=o.fulfilled?e:n;if("function"==typeof t)try{u(t(o.value))}catch(e){c(e)}else o.fulfilled?u(o.value):c(o.value)}o.fulfilled||o.rejected?t(f):o.queue.push(f)})},i.prototype.catch=function(e){return this.then(null,e)},i.defer=function(){var e={};return e.promise=new i(function(n,t){e.resolve=n,e.reject=t}),e},i.when=function(e){return e&&e.then?e:i.resolve(e)},i.resolve=function(e){return new i(function(n){n(e)})},i.reject=function(e){return new i(function(n,t){t(e)})},i.all=function(e){var n=e.length;return new i(function(t,o){var c=new Array(n);e.forEach(function(e,f){var i=function(e){c[f]=e,--n||t(c)};u(e)?e.then.call(e,i,o):i(e)})})},i.race=function(e){return new i(function(n,t){e.forEach(function(e){u(e)?e.then.call(e,n,t):n(e)})})},i});