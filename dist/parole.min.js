!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.Parole=e()}(this,function(){"use strict";var n=function(){if("object"==typeof process&&process&&"function"==typeof process.nextTick)return process.nextTick;if("MutationObserver"in window||"WebKitMutationObserver"in window)return function(n,e){var t=[],o=0;function u(){e.data=o=++o%2}return new n(function(){var n=t.shift();t.length>0&&u(),n instanceof Function&&n()}).observe(e,{characterData:!0}),function(n){t.push(n),u()}}(window.MutationObserver||window.WebKitMutationObserver,document.createTextNode(""));var n=function(n){if("function"!=typeof n)throw new TypeError(n+" is not a Function");return n};return"function"==typeof setImmediate?function(e){setImmediate(n(e))}:"function"==typeof setTimeout||"object"==typeof setTimeout?function(e){setTimeout(n(e),0)}:void 0}();function e(n){return"object"==typeof n||"function"==typeof n}function t(n){return e(n)&&"then"in n}function o(n,t,u,i,r){var c,f;if(t&&e(t))try{if(t===n)throw new TypeError("A promise can not be resolved by itself");c=t.then,u&&"function"==typeof c?function(n,e,t,o,u,i){try{n.call(o,function(n){e(t,n,!0,u,i)},function(n){e(t,n,!1,u,i)})}catch(n){e(t,n,!1,u,i)}}(c,(f=o,function(){f&&f.apply(this,arguments),f=null}),n,t,i,r):(u?i:r)(t)}catch(n){r(n)}else(u?i:r)(t)}var u=null;function i(n,e,t){for(var o=0,i=n.length;o<i;o++)n[o]();n.splice(),e&&u&&u(t)}function r(e){if(!(this instanceof r))return new r(e);var t=this,u=function(e){t.fulfilled||t.rejected||(t.rejected=!0,t.value=e,n(function(){i(t.queue,!t.caught,t.value)}))};t.queue=[],e(function(e){o(t,e,!0,function(e){t.fulfilled||t.rejected||(t.fulfilled=!0,t.value=e,n(function(){i(t.queue)}))},u)},u)}return r.onUncaught=function(n){u=n},r.prototype.then=function(e,t){var o=this;return t instanceof Function&&(o.caught=!0),new r(function(u,i){function r(){var n=o.fulfilled?e:t;if("function"==typeof n)try{u(n(o.value))}catch(n){i(n)}else o.fulfilled?u(o.value):i(o.value)}o.fulfilled||o.rejected?n(r):o.queue.push(r)})},r.prototype.catch=function(n){return this.then(null,n)},r.defer=function(){var n={};return n.promise=new r(function(e,t){n.resolve=e,n.reject=t}),n},r.when=function(n){return n&&n.then?n:r.resolve(n)},r.resolve=function(n){return new r(function(e){e(n)})},r.reject=function(n){return new r(function(e,t){t(n)})},r.all=function(n){var e=n.length;return new r(function(o,u){var i=new Array(e);n.forEach(function(n,r){var c=function(n){i[r]=n,--e||o(i)};t(n)?n.then.call(n,c,u):c(n)}),i.length||o(i)})},r.race=function(n){return new r(function(e,o){n.forEach(function(n){t(n)?n.then.call(n,e,o):e(n)}),n.length||e()})},r});