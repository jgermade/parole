!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):e.Parole=n()}(this,function(){var e,n,t,o,u="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"MessageChannel"in(e="object"==typeof window?window:this)?((n=new MessageChannel).port1.onmessage=function(){t()},function(e){t=e,n.port2.postMessage(0)}):"MutationObserver"in e?(o=document.createTextNode(""),function(e){var n=new MutationObserver(function(){e(),n.disconnect()});n.observe(o,{characterData:!0}),o.data=!1}):e.setImmediate||e.setTimeout;function c(e){return"object"==typeof e||"function"==typeof e}function i(e){return c(e)&&"then"in e}function f(e,n,t,o,u){var i,r;if(n&&c(n))try{if(n===e)throw new TypeError("A promise can not be resolved by itself");i=n.then,t&&"function"==typeof i?function(e,n,t,o,u,c){try{e.call(o,function(e){n(t,e,!0,u,c)},function(e){n(t,e,!1,u,c)})}catch(e){n(t,e,!1,u,c)}}(i,(r=f,function(){r&&r.apply(this,arguments),r=null}),e,n,o,u):(t?o:u)(n)}catch(e){u(e)}else(t?o:u)(n)}function r(e){for(var n=0,t=e.length;n<t;n++)e[n]()}function l(e){if(!(this instanceof l))return new l(e);var n=this,t=function(e){n.fulfilled||n.rejected||(n.rejected=!0,n.value=e,u(function(){r(n.queue)}))};n.queue=[],e(function(e){f(n,e,!0,function(e){n.fulfilled||n.rejected||(n.fulfilled=!0,n.value=e,u(function(){r(n.queue)}))},t)},t)}return l.prototype.then=function(e,n){var t=this;return new l(function(o,c){function i(){var u=t.fulfilled?e:n;if("function"==typeof u)try{o(u(t.value))}catch(e){c(e)}else t.fulfilled?o(t.value):c(t.value)}t.fulfilled||t.rejected?u(i):t.queue.push(i)})},l.prototype.catch=function(e){return this.then(null,e)},l.defer=function(){var e={};return e.promise=new l(function(n,t){e.resolve=n,e.reject=t}),e},l.when=function(e){return e&&e.then?e:l.resolve(e)},l.resolve=function(e){return new l(function(n){n(e)})},l.reject=function(e){return new l(function(n,t){t(e)})},l.all=function(e){var n=e.length;return new l(function(t,o){var u=new Array(n);e.forEach(function(e,c){var f=function(e){u[c]=e,--n||t(u)};i(e)?e.then.call(e,f,o):f(e)})})},l.race=function(e){return new l(function(n,t){e.forEach(function(e){i(e)?e.then.call(e,n,t):n(e)})})},l});