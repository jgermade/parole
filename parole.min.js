!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):e.Parole=n()}(this,function(){function e(e){for(var n=0,t=e.length;n<t;n++)e[n]()}var n,t,o,i="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"Promise"in(n="object"==typeof window?window:this)&&"function"==typeof n.Promise.resolve?(t=n.Promise.resolve()).then.bind(t):"MutationObserver"in n?(o=document.createTextNode(""),function(e){var n=new MutationObserver(function(){e(),n.disconnect()});n.observe(o,{characterData:!0}),o.data=!1}):n.setImmediate||n.setTimeout;function u(e){return"object"==typeof e||"function"==typeof e}function r(e){return u(e)&&"then"in e}function c(e,n,t,o,i){var r,f;if(n&&u(n))try{if(n===e)throw new TypeError("A promise can not be resolved by itself");r=n.then,t&&"function"==typeof r?function(e,n,t,o,i,u){try{e.call(o,function(e){n(t,e,!0,i,u)},function(e){n(t,e,!1,i,u)})}catch(e){n(t,e,!1,i,u)}}(r,(f=c,function(){f&&f.apply(this,arguments),f=null}),e,n,o,i):(t?o:i)(n)}catch(e){i(e)}else(t?o:i)(n)}function f(n){if(!(this instanceof f))return new f(n);var t=this,o=function(n){t.fulfilled||t.rejected||(t.rejected=!0,t.value=n,i(function(){e(t.queue)}))};t.queue=[],n(function(n){c(t,n,!0,function(n){t.fulfilled||t.rejected||(t.fulfilled=!0,t.value=n,i(function(){e(t.queue)}))},o)},o)}return f.prototype.then=function(e,n){var t=this;return new f(function(o,u){function r(){var i=t.fulfilled?e:n;if("function"==typeof i)try{o(i(t.value))}catch(e){u(e)}else t.fulfilled?o(t.value):u(t.value)}t.fulfilled||t.rejected?i(r):t.queue.push(r)})},f.prototype.catch=function(e){return this.then(null,e)},f.defer=function(){var e={};return e.promise=new f(function(n,t){e.resolve=n,e.reject=t}),e},f.when=function(e){return e&&e.then?e:f.resolve(e)},f.resolve=function(e){return new f(function(n){n(e)})},f.reject=function(e){return new f(function(n,t){t(e)})},f.all=function(e){var n=e.length;return new f(function(t,o){var i=new Array(n);e.forEach(function(e,u){var c=function(e){i[u]=e,--n||t(i)};r(e)?e.then.call(e,c,o):c(e)}),i.length||t(i)})},f.race=function(e){return new f(function(n,t){e.forEach(function(e){r(e)?e.then.call(e,n,t):n(e)}),e.length||n()})},f});